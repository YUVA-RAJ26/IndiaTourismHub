{% include 'user_module/base.html' %}



<!-- AWS S3 Checking -->
<!-- {% load static %}<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>S3 Example Static Only</title>
  <link rel="stylesheet" type="text/css" href="{% static 'css/app.css' %}">
</head>
<body>
  <header>
    <h1>S3 Example Static Only</h1>
  </header>
  <main>
    <img src="{% static 'img/thumbs-up.png' %}">
    <h2>It's working!</h2>
  </main>
  <footer>
    <a href="https://simpleisbetterthancomplex.com">www.SimpleIsBetterThanComplex.com</a>
  </footer>
</body>
</html> -->


<h3>Welcome {{ request.user }}</h3>
<input type="hidden" id="is_staff_value" value="{{ request.user.is_staff }}">


{% if request.user.is_staff %}
    <a href="{% url 'admin_module:hotel_list' %}" class="btn btn-primary">Go to Hotel List</a>
{% endif %}
<a href="{% url 'admin_module:tourist_list' %}" class="btn btn-primary">Go to Tourist List</a>
<a href="{% url 'admin_module:tour_package_list' %}" class="btn btn-primary">Go to Tour Package List</a>
<a href="{% url 'user_module:booking_list' %}" class="btn btn-primary">Go to Booking List</a>

<br>
<br>
{% if request.user.is_superuser %}

<div class="container">
  <div class="row">
      <div class="col-md-6">
          <label for="stateDropdown" class="form-label">State:</label>
          <select id="stateDropdown" class="form-select">
              <option value="all">All</option> <!-- Option for selecting all states -->
              {% for state in states %}
              <option value="{{ state.id }}">{{ state.name }}</option>
              {% endfor %}
          </select>
      </div>
      <div class="col-md-6">
          <label for="tourPackageDropdown" class="form-label">Tour Package:</label>
          <select id="tourPackageDropdown" class="form-select">
              <option value="all">All</option> <!-- Option for selecting all tour packages -->
              {% for tourpackage in tourpackages %}
              <option value="{{ tourpackage.id }}">{{ tourpackage.name }}</option>
              {% endfor %}
          </select>
      </div>
  </div>
</div>


<!-- Graphs -->
<!-- Include Chart.js library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- CHARTS -->
<style>
    .chart-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-gap: 20px;
    }
</style>

<div class="chart-container">
    <div style="width: 100%; height: 400px;">
        <!-- Pie Chart -->
        <canvas id="pieChart"></canvas>
    </div>

    <div style="width: 100%; height: 400px;">
        <!-- Bar Chart -->
        <canvas id="barChart"></canvas>
    </div>
</div>

{% endif %}
<script>
  var pieChart, barChart; // Declare the variables outside the function
  
  function renderCharts(context) {
      console.log(context); // Add this line to check the content of the context object
  
      // Destroy existing charts
      if (typeof pieChart !== 'undefined' && pieChart !== null) {
          pieChart.destroy();
      }
      if (typeof barChart !== 'undefined' && barChart !== null) {
          barChart.destroy();
      }
  
      // Get the data from the response context
      var pieLabels = ["Approved", "Rejected", "Pending"];
      var pieData = context.pie_data;
      var barLabels = ["Approved", "Rejected", "Pending"];
      var barData = context.bar_data;
  
      // Create the pie chart
      pieChart = new Chart(document.getElementById('pieChart'), {
          type: 'pie',
          data: {
              labels: pieLabels,
              datasets: [{
                  data: pieData,
                  backgroundColor: ['#36A2EB', '#FF6384', '#FFCE56']
              }]
          },
          options: {
              responsive: true
          }
      });
  
      // Create the bar chart
      barChart = new Chart(document.getElementById('barChart'), {
          type: 'bar',
          data: {
              labels: barLabels,
              datasets: [{
                  data: barData,
                  backgroundColor: ['#36A2EB', '#FF6384', '#FFCE56']
              }]
          },
          options: {
              responsive: true,
              scales: {
                  y: {
                      beginAtZero: true
                  }
              }
          }
      });
  }
  </script>


<br><br>
{% if user.is_staff %}
    <a href="{% url 'user_module:download_charts' %}" class="btn btn-primary">Download Charts as PDF</a>
{% endif %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
  $(document).ready(function () {
    // Function to fetch and display the bookings graph
    function fetchBookingGraph() {
      var selectedState = $("#stateDropdown").val();
      var selectedTourPackage = $("#tourPackageDropdown").val();
      var authToken = '{{ authToken }}';
      $.ajax({
        url: "{% url 'user_module:get_context_data' %}",
        type: "GET",
        data: { state: selectedState, tourPackage: selectedTourPackage },
        headers: { 
          "X-CSRFTOKEN": "{{ csrf_token }}",
          "Authorization": "{{ authToken }}"
        },
        success: function (response) {
          renderCharts(context=response);
        },
        error: function (error) {
          console.log(error);
        },
      });
    }

    // Event listener for dropdown change events
    $("#stateDropdown, #tourPackageDropdown").on("change", fetchBookingGraph);

    // Initial fetch of the bookings graph
    fetchBookingGraph();
  });
</script>
